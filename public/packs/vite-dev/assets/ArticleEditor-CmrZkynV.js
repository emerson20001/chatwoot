import{_ as le,n as H,o as L,p as f,r as x,c as I,e as g,H as h,g as k,t as N,l as b,a as M,f as pe,Y as Ee,w as me,L as oe}from"./_plugin-vue_export-helper-DG4P_01H.js";import{d as F}from"./utils.esm-DGys-UJ9.js";import{d as fe,u as z,b as ge,c as W}from"./useBranding-CBxaH_1a.js";import{k as he,u as ve,h as Ae,i as Ie,j as X,c as Z,m as _e,g as Te,n as ie,o as Re,p as Ce,q as Se}from"./dashboard-DQ6o-rnY.js";import{_ as Le}from"./HelpCenterLayout-XWan7oYZ.js";import{P as ye,S as Pe,p as be,K as we,E as xe,n as $e,L as Ue,N as J}from"./typing-BFENwHg8.js";import{u as B,a as Q}from"./index-C7w1By4V.js";import{u as ne,w as De}from"./Validators-BM89Tp7H.js";import{at as G,aC as ee}from"./DashboardIcon-B1kA0qZ4.js";import{_ as w}from"./index-CMsfCoUB.js";import{_ as Oe}from"./index-BrJsJnGg.js";function ke(e){if(!e)return!1;try{const{protocol:o}=new URL(e);return o==="http:"||o==="https:"}catch{return!1}}function te(e,o,i){const a=i.state.tr;i.state.doc.descendants((r,c)=>{r.type.name==="image"&&r.attrs.src===e&&(o?a.setNodeMarkup(c,null,{...r.attrs,src:o}):a.delete(c,c+r.nodeSize))}),a.docChanged&&i.dispatch(a)}const Ne=e=>new ye({props:{handlePaste(o,i,a){const r=[],c=[];a.content.descendants(n=>{if(n.type.name==="image"){const E=n.attrs.src;ke(E)?r.push(E):c.push(E)}}),setTimeout(()=>{c.forEach(n=>te(n,null,o)),r.forEach(async n=>{try{const E=await e(n);te(n,E,o)}catch(E){console.error("Error uploading image:",E)}})},0)}}}),se=4,ae=(e,o,i=[],a={},r)=>xe.create({doc:new Ue(J).parse(e),plugins:$e({schema:J,placeholder:o,methods:a,plugins:i,enabledMenuOptions:r})});let A=null,P;const He={mixins:[he],props:{modelValue:{type:String,default:""},editorId:{type:String,default:""},placeholder:{type:String,default:""},enabledMenuOptions:{type:Array,default:()=>[]},autofocus:{type:Boolean,default:!0}},emits:["blur","input","update:modelValue","keyup","focus","keydown"],setup(){const{uiSettings:e,updateUISettings:o}=ve();return{uiSettings:e,updateUISettings:o}},data(){return{plugins:[Ne(this.handleImageUpload)],isTextSelected:!1}},watch:{modelValue(e=""){e!==this.contentFromEditor()&&this.reloadState()},editorId(){this.reloadState()}},created(){P=ae(this.modelValue,this.placeholder,this.plugins,{onImageUpload:this.openFileBrowser},this.enabledMenuOptions)},mounted(){this.createEditorView(),A.updateState(P),this.autofocus&&this.focusEditorInputField()},methods:{contentFromEditor(){return A?we.serialize(A.state.doc):""},openFileBrowser(){this.$refs.imageUploadInput.click()},async handleImageUpload(e){try{return await this.$store.dispatch("articles/uploadExternalImage",{portalSlug:this.$route.params.portalSlug,url:e})}catch{return B(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.UN_AUTHORIZED_ERROR")),""}},onFileChange(){const e=this.$refs.imageUploadInput.files[0];fe(e,se)?this.uploadImageToStorage(e):B(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR_FILE_SIZE",{size:se})),this.$refs.imageUploadInput.value=""},async uploadImageToStorage(e){try{const o=await this.$store.dispatch("articles/attachImage",{portalSlug:this.$route.params.portalSlug,file:e});o&&this.onImageUploadStart(o)}catch{B(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR"))}},onImageUploadStart(e){const{selection:o}=A.state,i=o.from,a=A.state.schema.nodes.image.create({src:e}),r=A.state.schema.node("paragraph");if(a){const c=A.state.tr.replaceSelectionWith(r).insert(i+1,a);A.dispatch(c.scrollIntoView()),this.focusEditorInputField()}},reloadState(){P=ae(this.modelValue,this.placeholder,this.plugins,{onImageUpload:this.openFileBrowser},this.enabledMenuOptions),A.updateState(P),this.focusEditorInputField()},createEditorView(){A=new be(this.$refs.editor,{state:P,dispatchTransaction:e=>{P=P.apply(e),A.updateState(P),e.docChanged&&this.emitOnChange(),this.checkSelection(P)},handleDOMEvents:{keyup:this.onKeyup,focus:this.onFocus,blur:this.onBlur,keydown:this.onKeydown,paste:(e,o)=>{const i=o.clipboardData.files;i.length>0&&(i.forEach(a=>{a.type.includes("image")&&this.uploadImageToStorage(a)}),o.preventDefault())}}})},handleKeyEvents(){},focusEditorInputField(){const{tr:e}=A.state,o=Pe.atEnd(e.doc);A.dispatch(e.setSelection(o)),A.focus()},emitOnChange(){this.$emit("update:modelValue",this.contentFromEditor()),this.$emit("input",this.contentFromEditor())},onKeyup(){this.$emit("keyup")},onKeydown(){this.$emit("keydown")},onBlur(){this.$emit("blur")},onFocus(){this.$emit("focus")},checkSelection(e){const{from:o,to:i}=e.selection,a=o!==i;if(a===this.isTextSelected)return;this.isTextSelected=a;const{editor:r}=this.$refs;r.classList.toggle("has-selection",a),a&&this.setMenubarPosition(e)},setMenubarPosition(e){if(!e.selection)return;const{from:o,to:i}=e.selection,{editor:a}=this.$refs,{left:r,top:c}=a.getBoundingClientRect(),n=a.offsetWidth,E=480,{bottom:u,right:p}=A.coordsAtPos(i),{left:m}=A.coordsAtPos(o),S=u-c+10,R=Math.max(0,Math.min((m+p)/2-r,n-E));a.style.setProperty("--selection-top",`${S}px`),a.style.setProperty("--selection-left",`${R}px`)}}},Ve={class:"editor-root editor--article"},Me={ref:"editor"};function Be(e,o,i,a,r,c){return L(),H("div",null,[f("div",Ve,[f("input",{ref:"imageUploadInput",type:"file",accept:"image/png, image/jpeg, image/jpg, image/gif, image/webp",hidden:"",onChange:o[0]||(o[0]=(...n)=>c.onFileChange&&c.onFileChange(...n))},null,544),f("div",Me,null,512)])])}const Fe=le(He,[["render",Be]]),Ge={class:"flex items-center justify-between h-20"},ze={class:"flex items-center gap-4"},je={key:0,class:"text-xs font-medium transition-all duration-300 text-n-slate-11"},Ke={class:"flex items-center gap-2"},We={class:"relative"},Ze={__name:"ArticleEditorHeader",props:{isUpdating:{type:Boolean,default:!1},isSaved:{type:Boolean,default:!1},status:{type:String,default:""},articleId:{type:Number,default:0}},emits:["goBack","previewArticle"],setup(e,{emit:o}){const i=e,a=o,{t:r}=z(),c=ge(),n=ne(),E=x(!1),{ARTICLE_STATUS_TYPES:u}=De,p=x(!1),m=I(()=>(Ae[i.status]??[]).map(l=>{const{label:v,value:_,icon:j}=Ie[l];return{label:r(v),value:_,action:"update-status",icon:j}})),S=I(()=>r(`HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.STATUS.${i.isUpdating?"SAVING":"SAVED"}`)),R=()=>a("goBack"),$=()=>a("previewArticle"),C=(T,l)=>{const v=l?"SUCCESS":"ERROR",_={[u.PUBLISH]:"PUBLISH_ARTICLE",[u.ARCHIVE]:"ARCHIVE_ARTICLE",[u.DRAFT]:"DRAFT_ARTICLE"};return _[T]?r(`HELP_CENTER.${_[T]}.API.${v}`):""},U=async({value:T})=>{p.value=!1;const l=Te(T);l===u.PUBLISH&&(E.value=!0);const{portalSlug:v}=n.params;try{await c.dispatch("articles/update",{portalSlug:v,articleId:i.articleId,status:l}),B(C(l,!0)),l===u.ARCHIVE?Q(ee.ARCHIVE_ARTICLE,{uiFrom:"header"}):l===u.PUBLISH&&Q(ee.PUBLISH_ARTICLE),E.value=!1}catch(_){B((_==null?void 0:_.message)??C(l,!1)),E.value=!1}};return(T,l)=>(L(),H("div",Ge,[g(w,{label:h(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.BACK_TO_ARTICLES"),icon:"i-lucide-chevron-left",variant:"link",color:"slate",size:"sm",class:"ltr:pl-3 rtl:pr-3",onClick:R},null,8,["label"]),f("div",ze,[e.isUpdating||e.isSaved?(L(),H("span",je,N(S.value),1)):k("",!0),f("div",Ke,[g(w,{label:h(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.PREVIEW"),color:"slate",size:"sm",disabled:!e.articleId,onClick:$},null,8,["label","disabled"]),g(_e,{class:"flex items-center"},{default:b(()=>[g(w,{label:h(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.PUBLISH"),size:"sm",class:"ltr:rounded-r-none rtl:rounded-l-none","no-animation":"","is-loading":E.value,disabled:e.status===h(X).PUBLISHED||!e.articleId||E.value,onClick:l[0]||(l[0]=v=>U({value:h(X).PUBLISHED}))},null,8,["label","is-loading","disabled"]),f("div",We,[g(h(G),{onTrigger:l[3]||(l[3]=v=>p.value=!1)},{default:b(()=>[g(w,{icon:"i-lucide-chevron-down",size:"sm",disabled:!e.articleId,"no-animation":"",class:"ltr:rounded-l-none rtl:rounded-r-none",onClick:l[1]||(l[1]=pe(v=>p.value=!p.value,["stop"]))},null,8,["disabled"]),p.value?(L(),M(Z,{key:0,"menu-items":m.value,class:"mt-2 ltr:right-0 rtl:left-0 top-full",onAction:l[2]||(l[2]=v=>U(v))},null,8,["menu-items"])):k("",!0)]),_:1})])]),_:1})])])]))}},qe={class:"flex flex-col absolute w-[25rem] bg-n-alpha-3 outline outline-1 outline-n-container backdrop-blur-[100px] shadow-lg gap-6 rounded-xl p-6"},Ye={class:"flex items-center justify-between"},Xe={class:"flex flex-col gap-2"},Je={class:"flex justify-between w-full gap-4 py-2"},Qe={class:"text-sm font-medium whitespace-nowrap min-w-[6.25rem] text-n-slate-12"},et={class:"flex justify-between w-full gap-2 py-2"},tt={class:"flex justify-between w-full gap-3 py-2"},st={class:"text-sm font-medium whitespace-nowrap min-w-[7.5rem] text-n-slate-12"},at={__name:"ArticleEditorProperties",props:{article:{type:Object,required:!0}},emits:["saveArticle","close"],setup(e,{emit:o}){const i=e,a=o,r=F(u=>a("saveArticle",u),400,!1),{t:c}=z(),n=Ee({title:"",description:"",tags:[]}),E=()=>{var u,p,m;n.title=((u=i.article.meta)==null?void 0:u.title)||"",n.description=((p=i.article.meta)==null?void 0:p.description)||"",n.tags=((m=i.article.meta)==null?void 0:m.tags)||[]};return me(n,u=>{r({title:u.title,description:u.description,tags:u.tags})},{deep:!0}),oe(()=>{E()}),(u,p)=>(L(),H("div",qe,[f("div",Ye,[f("h3",null,N(h(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.ARTICLE_PROPERTIES")),1),g(w,{icon:"i-lucide-x",size:"sm",variant:"ghost",color:"slate",class:"hover:text-n-slate-11",onClick:p[0]||(p[0]=m=>a("close"))})]),f("div",Xe,[f("div",null,[f("div",Je,[f("label",Qe,N(h(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_DESCRIPTION")),1),g(ie,{modelValue:n.description,"onUpdate:modelValue":p[1]||(p[1]=m=>n.description=m),placeholder:h(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_DESCRIPTION_PLACEHOLDER"),class:"w-[13.75rem]","custom-text-area-wrapper-class":"!p-0 !border-0 !rounded-none !bg-transparent transition-none","custom-text-area-class":"max-h-[9.375rem]","auto-height":"","min-height":"3rem"},null,8,["modelValue","placeholder"])]),f("div",et,[g(Re,{modelValue:n.title,"onUpdate:modelValue":p[2]||(p[2]=m=>n.title=m),placeholder:h(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TITLE_PLACEHOLDER"),label:h(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TITLE"),"custom-label-class":"min-w-[7.5rem]"},null,8,["modelValue","placeholder","label"])]),f("div",tt,[f("label",st,N(h(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TAGS")),1),g(Ce,{modelValue:n.tags,"onUpdate:modelValue":p[3]||(p[3]=m=>n.tags=m),placeholder:h(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TAGS_PLACEHOLDER"),class:"w-[14rem]"},null,8,["modelValue","placeholder"])])])])]))}},lt={class:"flex items-center gap-4"},ot={class:"relative flex items-center gap-2"},it={class:"text-sm text-n-slate-12 hover:text-n-slate-11"},nt={class:"relative"},rt={key:0,class:"text-sm text-n-slate-12 hover:text-n-slate-11"},ct={class:"relative"},ut={__name:"ArticleEditorControls",props:{article:{type:Object,default:()=>({})}},emits:["saveArticle","setAuthor","setCategory"],setup(e,{emit:o}){const i=e,a=o,{t:r}=z(),c=ne(),n=x(!1),E=x(!1),u=x(!1),p=x(null),m=x(null),S=W("agents/getAgents"),R=W("categories/allCategories"),$=W("getCurrentUserID"),C=I(()=>{var s;return!((s=i.article)!=null&&s.id)}),U=I(()=>S.value.find(s=>s.id===$.value)),T=I(()=>c.params.categorySlug),l=I(()=>{var s;return C.value?p.value?S.value.find(t=>t.id===p.value):U.value:((s=i.article)==null?void 0:s.author)||null}),v=I(()=>{var s,t;return((s=l.value)==null?void 0:s.name)||((t=l.value)==null?void 0:t.available_name)||""}),_=I(()=>{var s;return(s=l.value)==null?void 0:s.thumbnail}),j=I(()=>{var s;return((s=S.value)==null?void 0:s.map(({name:t,id:d,thumbnail:y})=>{var O,V;return{label:t,value:d,thumbnail:{name:t,src:y},isSelected:(V=(O=i.article)==null?void 0:O.author)!=null&&V.id?d===i.article.author.id:d===(p.value||$.value),action:"assignAuthor"}}).toSorted((t,d)=>t.isSelected!==d.isSelected?Number(d.isSelected)-Number(t.isSelected):t.label.localeCompare(d.label)))??[]}),re=I(()=>{var s;return((s=S.value)==null?void 0:s.length)>1}),q=s=>{var t;return(t=R.value)==null?void 0:t.find(d=>d.slug===s)},ce=s=>{const t=q(s);return t?(m.value=t.id,t):null},D=I(()=>{if(C.value){if(T.value){const s=ce(T.value);if(s)return s}return m.value?R.value.find(s=>s.id===m.value):R.value[0]||null}return R.value.find(s=>{var t,d;return s.id===((d=(t=i.article)==null?void 0:t.category)==null?void 0:d.id)})}),Y=I(()=>R.value.map(({name:s,id:t,icon:d})=>{var y,O,V;return{label:s,value:t,emoji:d,isSelected:C.value?t===(m.value||((y=D.value)==null?void 0:y.id)):t===((V=(O=i.article)==null?void 0:O.category)==null?void 0:V.id),action:"assignCategory"}}).toSorted((s,t)=>Number(t.isSelected)-Number(s.isSelected))),ue=I(()=>{var s;return((s=Y.value)==null?void 0:s.length)>0}),K=({action:s,value:t})=>{var y;const d={assignAuthor:()=>{C.value?(p.value=t,a("setAuthor",t)):a("saveArticle",{author_id:t}),n.value=!1},assignCategory:()=>{C.value?(m.value=t,a("setCategory",t)):a("saveArticle",{category_id:t}),E.value=!1}};(y=d[s])==null||y.call(d)},de=s=>{a("saveArticle",{meta:s})};return oe(()=>{if(T.value&&C.value){const s=q(T.value);s&&K({action:"assignCategory",value:s==null?void 0:s.id})}}),(s,t)=>(L(),H("div",lt,[f("div",ot,[g(h(G),{onTrigger:t[1]||(t[1]=d=>n.value=!1)},{default:b(()=>[g(w,{variant:"ghost",color:"slate",class:"!px-0 font-normal hover:!bg-transparent","text-variant":"info",onClick:t[0]||(t[0]=d=>n.value=!n.value)},{default:b(()=>[g(Oe,{name:v.value,src:_.value,size:20,"rounded-full":""},null,8,["name","src"]),f("span",it,N(v.value||"-"),1)]),_:1}),n.value&&re.value?(L(),M(Z,{key:0,"menu-items":j.value,"show-search":"",class:"z-[100] w-48 mt-2 overflow-y-auto ltr:left-0 rtl:right-0 top-full max-h-60",onAction:K},null,8,["menu-items"])):k("",!0)]),_:1})]),t[7]||(t[7]=f("div",{class:"w-px h-3 bg-n-weak"},null,-1)),f("div",nt,[g(h(G),{onTrigger:t[3]||(t[3]=d=>E.value=!1)},{default:b(()=>{var d,y;return[g(w,{label:((d=D.value)==null?void 0:d.name)||h(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.UNCATEGORIZED"),icon:(y=D.value)!=null&&y.icon?"":"i-lucide-shapes",variant:"ghost",color:"slate",class:"!px-2 font-normal hover:!bg-transparent",onClick:t[2]||(t[2]=O=>E.value=!E.value)},{default:b(()=>[D.value?(L(),H("span",rt,N(`${D.value.icon||""} ${D.value.name||h(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.UNCATEGORIZED")}`),1)):k("",!0)]),_:1},8,["label","icon"]),E.value&&ue.value?(L(),M(Z,{key:0,"menu-items":Y.value,"show-search":"",class:"w-48 mt-2 z-[100] overflow-y-auto left-0 top-full max-h-60",onAction:K},null,8,["menu-items"])):k("",!0)]}),_:1})]),t[8]||(t[8]=f("div",{class:"w-px h-3 bg-n-weak"},null,-1)),f("div",ct,[g(h(G),{onTrigger:t[6]||(t[6]=d=>u.value=!1)},{default:b(()=>[g(w,{label:h(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.MORE_PROPERTIES"),icon:"i-lucide-plus",variant:"ghost",color:"slate",disabled:C.value,class:"!px-2 font-normal hover:!bg-transparent hover:!text-n-slate-11",onClick:t[4]||(t[4]=d=>u.value=!u.value)},null,8,["label","disabled"]),u.value?(L(),M(at,{key:0,article:e.article,class:"right-0 z-[100] mt-2 xl:left-0 top-full",onSaveArticle:de,onClose:t[5]||(t[5]=d=>u.value=!1)},null,8,["article"])):k("",!0)]),_:1})])]))}},dt={class:"flex flex-col gap-3 pl-4 mb-3 rtl:pr-3 rtl:pl-0"},pt={__name:"ArticleEditor",props:{article:{type:Object,default:()=>({})},isUpdating:{type:Boolean,default:!1},isSaved:{type:Boolean,default:!1}},emits:["saveArticle","saveArticleAsync","goBack","setAuthor","setCategory","previewArticle"],setup(e,{emit:o}){const i=e,a=o,{t:r}=z(),c=I(()=>{var l;return!((l=i.article)!=null&&l.id)}),n=l=>{a("saveArticle",l)},E=F(l=>a("saveArticleAsync",l),400,!1),u=F(n,2500,!1),p=F(n,400,!1),m=l=>{c.value?p(l):(E(l),u(l))},S=I({get:()=>i.article.title,set:l=>{m({title:l})}}),R=I({get:()=>i.article.content,set:l=>{m({content:l})}}),$=()=>{a("goBack")},C=l=>{a("setAuthor",l)},U=l=>{a("setCategory",l)},T=()=>{a("previewArticle")};return(l,v)=>(L(),M(Le,{"show-header-title":!1,"show-pagination-footer":!1},{"header-actions":b(()=>[g(Ze,{"is-updating":e.isUpdating,"is-saved":e.isSaved,status:e.article.status,"article-id":e.article.id,onGoBack:$,onPreviewArticle:T},null,8,["is-updating","is-saved","status","article-id"])]),content:b(()=>[f("div",dt,[g(ie,{modelValue:S.value,"onUpdate:modelValue":v[0]||(v[0]=_=>S.value=_),"auto-height":"","min-height":"4rem","custom-text-area-class":"!text-[32px] !leading-[48px] !font-medium !tracking-[0.2px]","custom-text-area-wrapper-class":"border-0 !bg-transparent dark:!bg-transparent !py-0 !px-0",placeholder:"Title",autofocus:""},null,8,["modelValue"]),g(ut,{article:e.article,onSaveArticle:n,onSetAuthor:C,onSetCategory:U},null,8,["article"])]),g(Fe,{modelValue:R.value,"onUpdate:modelValue":v[1]||(v[1]=_=>R.value=_),class:"py-0 pb-10 pl-4 rtl:pr-4 rtl:pl-0 h-fit",placeholder:h(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.EDITOR_PLACEHOLDER"),"enabled-menu-options":h(Se),autofocus:!1},null,8,["modelValue","placeholder","enabled-menu-options"])]),_:1}))}},Ct=le(pt,[["__scopeId","data-v-8d205a02"]]);export{Ct as A};
